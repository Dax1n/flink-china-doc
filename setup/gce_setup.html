<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1-SNAPSHOT 中文文档: Google Compute Engine 安装</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink.apache.org"><img alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/">中文文档 1.1</a></li>

            <li class="hidden-sm "><a href="/features.html">特性</a></li>

            <!-- Quickstart -->
            <li class="dropdown">
              <a href="/quickstart" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">快速起步<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/quickstart/setup_quickstart.html">安装</a></li>
                
                <li class=""><a href="/quickstart/run_example_quickstart.html">Example: Wikipedia Edit Stream</a></li>
                
                <li class=""><a href="/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/quickstart/scala_api_quickstart.html">Scala API</a></li>
                
              </ul>
            </li>

            <!-- Setup -->
            <li class="dropdown active">
              <a href="/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">安装 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/setup/building.html">构建 Flink</a></li>
                
                <li class=""><a href="/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>部署</strong></li>
                
                
                <li class=""><a href="/setup/local_setup.html">本地</a></li>
                
                <li class=""><a href="/setup/cluster_setup.html">集群 (Standalone)</a></li>
                
                <li class=""><a href="/setup/yarn_setup.html">YARN</a></li>
                
                <li class="active"><a href="/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown">
              <a href="/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">编程指南 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/apis/common/"><strong>基本概念</strong></a></li>
                
                <li class=""><a href="/apis/streaming/"><strong>Streaming 指南</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/apis/batch/"><strong>Batch 指南</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/apis/cli.html">命令行接口（CLI）</a></li>
                
                <li class=""><a href="/apis/local_execution.html">本地执行</a></li>
                
                <li class=""><a href="/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/apis/java8.html">Java 8</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">类库 <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/ml/">Machine Learning</a></li>
                  
                  <li class=""><a href="/apis/batch/libs/table.html">Relational: Table</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">内部 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/internals/stream_checkpointing.html">Data Streaming的容错机制</a></li>
                
                <li class=""><a href="/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/internals/add_operator.html">How-To: Add an Operator</a></li>
                
              </ul>
            </li>

          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a class="hidden-sm" href="http://blog.flink-china.org" target="_blank">
            <small><span class="glyphicon glyphicon-new-window"></span></small> 博客</a></li>
            <li class="hidden-sm "><a href="/about/">关于本站</a></li>
          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">搜索</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">

  
  
  <div class="col-md-8 col-md-offset-2 text">
    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    
    <div class="panel panel-default">
      <div class="panel-body"><strong>重要</strong>: 依赖于Scala的maven artifacts现在会添加一个Scala主版本的后缀，例如 "2.10" 或 "2.11". 请查阅<a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">迁移指南</a>.</div>
    </div>
    

    <h1>Google Compute Engine 安装</h1>


<p>本文介绍了如何在  <a href="https://cloud.google.com/compute/">Google Compute Engine</a> 集群上基于 Hadoop 1 或者 Hadoop 2 自动部署 Flink 。借助 Google 的 <a href="https://cloud.google.com/hadoop/bdutil">bdutil</a> 工具可以启动一个集群并基于 Hadoop 部署 Flink 。根据下列步骤开始吧。</p>

<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">前提条件</a>    <ul>
      <li><a href="#google-cloud-sdk" id="markdown-toc-google-cloud-sdk">安装 Google Cloud SDK</a></li>
      <li><a href="#bdutil" id="markdown-toc-bdutil">安装 bdutil</a></li>
    </ul>
  </li>
  <li><a href="#google-compute-engine--flink" id="markdown-toc-google-compute-engine--flink">在 Google Compute Engine 之上部署 Flink</a>    <ul>
      <li><a href="#bucket" id="markdown-toc-bucket">设置一个 bucket</a></li>
      <li><a href="#bdutil-" id="markdown-toc-bdutil-">适配 bdutil 配置</a></li>
      <li><a href="#flink-" id="markdown-toc-flink-">适配 Flink 配置</a></li>
      <li><a href="#flink--1" id="markdown-toc-flink--1">启动一个 Flink 集群</a></li>
      <li><a href="#flink--2" id="markdown-toc-flink--2">运行 Flink 示例程序</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">关闭集群</a></li>
    </ul>
  </li>
</ul>

<h1 id="section">前提条件</h1>

<h2 id="google-cloud-sdk">安装 Google Cloud SDK</h2>

<p>请根据该指南了解如何安装 <a href="https://cloud.google.com/sdk/">Google Cloud SDK</a>。 需要特别注意的是使用下列命令确保 Google Cloud 验证成功：</p>

<div class="highlight"><pre><code>gcloud auth login
</code></pre></div>

<h2 id="bdutil">安装 bdutil</h2>

<p>当前 bdutil 发布版本中并不包含 Flink 扩展。不过，你可以从 <a href="https://github.com/GoogleCloudPlatform/bdutil">GitHub</a> 获得最新版本 bdutil ，master分支已经支持 Flink :</p>

<div class="highlight"><pre><code>git clone https://github.com/GoogleCloudPlatform/bdutil.git
</code></pre></div>

<p>在源码下载完成之后，进入新创建的 <code>bdutil</code> 目录，继续下一个步骤。</p>

<h1 id="google-compute-engine--flink">在 Google Compute Engine 之上部署 Flink</h1>

<h2 id="bucket">设置一个 bucket</h2>

<p>如果没有的话，需要创建一个 bucket 用于配置 bdutil 和 staging 文件。gsutil 可以创建一个新的 bucket ：</p>

<div class="highlight"><pre><code>gsutil mb gs://&lt;bucket_name&gt;
</code></pre></div>

<h2 id="bdutil-">适配 bdutil 配置</h2>

<p>使用 bdutil 部署 Flink ，在 bdutil_env.sh 中至少需要配置下列参数。</p>

<div class="highlight"><pre><code>CONFIGBUCKET="&lt;bucket_name&gt;"
PROJECT="&lt;compute_engine_project_name&gt;"
NUM_WORKERS=&lt;number_of_workers&gt;

# set this to 'n1-standard-2' if you're using the free trial
GCE_MACHINE_TYPE="&lt;gce_machine_type&gt;"

# for example: "europe-west1-d"
GCE_ZONE="&lt;gce_zone&gt;"
</code></pre></div>

<h2 id="flink-">适配 Flink 配置</h2>

<p>bdutil 的 Flink 扩展已经为你处理好配置了。你可以在 <code>extensions/flink/flink_env.sh</code> 中添加配置参数。如果想进一步了解配置参数，请见 <a href="config.html">Flink 配置</a> 。在修改配置之后需要使用<code>bin/stop-cluster</code> 和 <code>bin/start-cluster</code>重启Flink。</p>

<h2 id="flink--1">启动一个 Flink 集群</h2>

<p>在 Google Compute Engine 上启动一个 Flink 集群，执行命令：</p>

<div class="highlight"><pre><code>./bdutil -e extensions/flink/flink_env.sh deploy
</code></pre></div>

<h2 id="flink--2">运行 Flink 示例程序</h2>

<div class="highlight"><pre><code>./bdutil shell
cd /home/hadoop/flink-install/bin
./flink run ../examples/batch/WordCount.jar gs://dataflow-samples/shakespeare/othello.txt gs://&lt;bucket_name&gt;/output
</code></pre></div>

<h2 id="section-1">关闭集群</h2>

<p>关闭一个 Flink 集群只需执行</p>

<div class="highlight"><pre><code>./bdutil -e extensions/flink/flink_env.sh delete
</code></pre></div>

     <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/wuchong/flink-china-doc/edit/master/setup/gce_setup.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
  </div>
  

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <!-- script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script -->

    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>


    <!-- Disqus -->
    
  </body>
</html>
